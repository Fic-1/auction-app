let e;var t=require("isomorphic-ws");function a(e){return e&&e.__esModule?e.default:e}const s=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},o=(e,t)=>{s();let a=`<div class="alert alert-${e}">${t}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",a),window.setTimeout(s,5e3)},d=async(e,t)=>{try{let a=await axios({method:"POST",url:"/api/v1/users/login",data:{email:e,password:t}});"success"===a.data.status&&(o("success","Logged in successfuly!"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){o("danger",e.response.data.message)}},n=async()=>{try{let e=await axios({method:"GET",url:"/api/v1/users/logout"});"success"===e.data.status&&location.reload(!0)}catch(e){o("error","Error logging out! Try again.")}},r=async(e,t,a,s,d)=>{let n=`${e}  ${t}`;s!==d&&o("danger","Passwords do not match"),a&&s&&d||o("danger","Please enter valid information");try{let e=await axios({method:"POST",url:"/api/v1/users/signup",data:{name:n,email:a,password:s,passwordConfirm:d}});"success"===e.data.status&&(o("success","Signed in successfuly!"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){o("danger",e.response.data.message)}},c=async e=>{try{let t=await axios({method:"POST",url:"/api/v1/users/forgot-password",data:{email:e}});"success"===t.data.status&&(o("success","Password reset token sent! Please check your email."),window.setTimeout(()=>{location.assign("/login")},1500))}catch(e){o("danger",e.response.data.message)}},u=async(e,t,a)=>{try{let s=await axios({method:"PATCH",url:`/api/v1/users/reset-password/${a}`,data:{password:e,passwordConfirm:t}});"success"===s.data.status&&(o("success","Password changed successfuly!"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){o("danger",e.response.data.message)}},l=async(e,t)=>{try{let a=await axios({method:"PATCH",url:"password"===t?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe",data:e});"Success"===a.data.status&&(o("success",`${t.toUpperCase()} changed successfuly!`),setTimeout(()=>window.location.reload(),3e3))}catch(e){o("error",e.response.data.message)}},i=async(e,t)=>{try{let a=`/my-products/${t}/edit/uploadCover`,s=await axios({method:"PATCH",url:a,data:e});"Success"===s.data.status&&(o("success","COVER IMAGE changed successfuly!"),setTimeout(()=>window.location.reload(),3e3))}catch(e){o("error",e.response.data.message)}},m=async(e,t,a)=>{try{let s="photos"===a?`/my-products/${t}/edit-photos`:`/my-products/${t}/edit-data`,d=await axios({method:"PATCH",url:s,data:e});"Success"===d.data.status&&o("success","PRODUCT DATA changed successfuly!")}catch(e){o("error",e.response.data.message)}},p=async(e,t)=>{try{let a=await axios({method:"POST",url:"/api/v1/products/create-my-product",data:e});"Success"===a.data.status&&(o("success","PRODUCT created successfuly!"),t.array.forEach(e=>{e.classList.toggle("hidden")}))}catch(e){o("error",e.response.data.message)}},g=()=>{let e=window.location.href,t=new URL(e),a=parseInt(t.searchParams.get("page"))||1;a++,t.searchParams.set("page",a),window.location.href=t.href},y=()=>{let e=window.location.href,t=new URL(e),a=parseInt(t.searchParams.get("page"))||1;a--,t.searchParams.set("page",a),window.location.href=t.href},v=Stripe("pk_test_51OUuIUBhYQwhtBdpefIQnW6Nsn4TFQh9ezwLyra1a1ugaAY1Og40fYiQNZbwoiursdFpCg9WfmCIp7M7JZu8Sz9H00HVEnECJS"),w=async e=>{try{let t=await axios(`/api/v1/checkouts/checkout-session/${e}`);await v.redirectToCheckout({sessionId:t.data.session.id})}catch(e){console.error(e),o("error",e)}},f=window.location.href,E=new URL(f),h=document.querySelector(".form--login"),B=document.querySelector(".logoutbtn"),I=document.querySelector(".form--signup"),S=document.querySelector(".user-data"),b=document.querySelector(".nav-tabs"),L=document.querySelector(".product-cover-form"),C=document.querySelector(".websocket-form"),q=document.querySelector(".product-photos-form"),k=document.querySelector(".change-password"),P=document.querySelector(".product-data-form"),T=document.querySelector(".form--forgot-password"),D=document.querySelector(".form--reset-password"),$=document.getElementById("btnAddBid"),x=document.querySelector(".imessage"),A=document.querySelector(".add-product"),O=document.querySelector(".add-product-form-div"),H=document.querySelector(".add-product-btn"),M=document.querySelector(".add-product-btn-toggled"),U=document.querySelector(".add-product-form"),_=document.querySelectorAll(".paginateDiv"),F=document.querySelector(".allProducts"),N=document.querySelector(".product-photos"),R=document.querySelector(".product-img"),J=document.getElementById("checkoutBtn");document.getElementById("forgotPasswordBtn");const Q=()=>{let e=document.getElementById("pagesTop"),t=document.getElementById("pagesBottom"),a=parseInt(E.searchParams.get("page"))||1,s=Math.ceil(Number(e.dataset.pages)/5);e.textContent=`${a-1<=0?"":a-1} [${a}] ${a+1>s?"":a+1}`,t.textContent=e.textContent,_.forEach(e=>{e.addEventListener("click",e=>{e.target.closest(".nextPage")&&g(),e.target.closest(".previousPage")&&y()})})};if(J&&J.addEventListener("click",e=>{e.target.textContent="Processing...",w(e.target.dataset.productid)}),F&&Q(),A&&(A.addEventListener("click",e=>{H.classList.toggle("hidden"),M.classList.toggle("hidden"),O.classList.toggle("hidden")}),U.addEventListener("submit",e=>{let t=new FormData;t.append("name",document.getElementById("create-form--name").value),t.append("description",document.getElementById("create-form--description").value),t.append("startingBid",document.getElementById("create-form--price").value),t.append("coverImage",document.getElementById("coverImage").files[0]),t.append("endDate",document.getElementById("create-form--date").value),p(t,[U,M,O])}),Q()),L){let e=document.querySelector(".label-id").dataset.id;L.addEventListener("submit",t=>{t.preventDefault();let a=new FormData;a.append("coverImage",document.getElementById("coverImage").files[0]),i(a,e)}),P.addEventListener("submit",t=>{t.preventDefault();let a=document.getElementById("product-data--name").value;m({name:a,description:document.getElementById("product-data--description").value,endDate:document.getElementById("product-data--endDate").value},e,"data")}),q.addEventListener("submit",t=>{t.preventDefault();let a=new FormData,s=document.getElementById("photos");for(let e=0;e<s.files.length;e++)a.append("photos",s.files[e]);m(a,e,"photos")})}h&&h.addEventListener("submit",e=>{e.preventDefault(),d(document.getElementById("email").value,document.getElementById("password").value)}),I&&I.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("fname").value,a=document.getElementById("lname").value;r(t,a,document.getElementById("email").value,document.getElementById("password").value,document.getElementById("passwordConfirm").value)}),B&&B.addEventListener("click",n),b&&b.addEventListener("click",e=>{let t=document.querySelectorAll(".nav-link"),a=document.querySelectorAll(".card-body");document.querySelector(".websocket-background");let s=e.target.closest("#product"),o=e.target.closest("#liveBid"),d=e.target.closest("#checkoutLink");document.getElementById("product"),document.getElementById("productContent"),document.getElementById("liveBid"),document.getElementById("liveBidContent"),document.getElementById("checkoutLink"),document.getElementById("checkoutContent"),(s||o||d)&&(a.forEach(e=>{e.classList.remove("card-flex"),e.classList.add("none")}),t.forEach((e,t)=>{e.classList.remove("active")}),e.target.closest(".nav-link").classList.add("active"),a.forEach((t,a)=>{a==e.target.closest(".nav-link").dataset.tab&&t.classList.add("card-flex")}))}),S&&S.addEventListener("submit",e=>{e.preventDefault();let t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),l(t,"data")}),k&&k.addEventListener("submit",async e=>{e.preventDefault(),document.querySelector(".btn--save-password ").textContent="Updating...";let t=document.getElementById("password-current").value,a=document.getElementById("password").value,s=document.getElementById("password-confirm").value;await l({passwordCurrent:t,password:a,passwordConfirm:s},"password"),document.querySelector(".btn--save-password ").textContent="Change password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""}),N&&N.addEventListener("click",e=>{e.target.closest(".product-photo")&&(R.src=e.target.closest(".product-photo").src)}),b&&(e=document.getElementById("product").dataset.id);const Y=(t,a,s,o)=>{let d;if(e=document.getElementById("product").dataset.id,"initialBids"===s.type&&(d=t.map(e=>{let t=numeral(e.amount).format("0,0.00");return`<p class=${e.bidder===userEmail?"from-me":"from-them"}>${e.bidder} <br><span>Added bid: </span><strong>${t} \u{20AC}</strong></p>`}).join(" "),o.innerHTML=d),"newBid"===s.type){let t=numeral(a.amount).format("0,0.00");d=`<p class=${a.bidder===userEmail?"from-me":"from-them"}>${a.bidder} <br><span>Added bid: </span><strong>${t} \u{20AC}</strong></p>`,e===a._id&&(o.innerHTML+=d)}"over"===s.type&&(d="<p class=over> Auction has ended </p>",o.innerHTML+=d)};if(b){userEmail=document.cookie.split(";").filter(e=>e.includes("user"))[0].trim().split("=")[1].replace("%40","@");let e=`ws://${window.location.host.split(":")[0]}:8080`,s=new(a(t))(e),d=e=>{let t=document.getElementById("product").dataset.id;if(!+e){o("error","Please enter the valid number");return}let a={_id:t,amount:e,bidder:userEmail},d=JSON.stringify(a);userEmail===a.bidder&&s.send(d)};s.onopen=function(){console.log("connected")},s.onclose=function(){s.close(),console.log("disconnected")},s.onmessage=e=>{let t=JSON.parse(e.data);Y(t._activeBids,t.bid,t,x)},$&&(C.addEventListener("keydown",e=>{"Enter"===e.key&&(d(C.value),C.value="")}),$.addEventListener("click",e=>{e.preventDefault,d(C.value),C.value=""})),window.addEventListener("unload",function(){s.readyState==a(t).OPEN&&s.close()})}T&&T.addEventListener("submit",e=>{e.preventDefault(),c(document.getElementById("email").value)}),D&&D.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("resetPasswordBtn").dataset.token;u(document.getElementById("password").value,document.getElementById("passwordConfirm").value,t)});
//# sourceMappingURL=index.js.map
